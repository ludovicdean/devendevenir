---
title : "Les regex, aussi effrayantes que puissantes"
tags :
- I-culture
description : ""
banner : "/images/kristian-strand-p8gzCnZf39k-unsplash.jpg"
author : "Kristian Strand"
authorlink : "https://unsplash.com/fr/@kristianstrand?utm_content=creditCopyText&utm_medium=referral&utm_source=unsplash"
unsplashlink : "https://unsplash.com/fr/photos/photographie-a-plat-du-lot-de-timbres-p8gzCnZf39k?utm_content=creditCopyText&utm_medium=referral&utm_source=unsplash"
isArticle : true
tableData1 :
  headers : ['m√©ta-caract√®re', 'explication', 'regex', 'exemple']
  rows :
  - ['+', '1 √† n fois le caract√®re qui le pr√©c√®de', 'dev+', 'dev, devv, devvv']
  - ['?', '0 ou n occurrences du caract√®re ou du groupe pr√©c√©dent', 'dev?', 'de, dev, devv']
  - ['^', "le d√©but d'une ligne", '^dev', 'dev, deva, devb']
  - ['$', "la fin d'une ligne", 'devenir$', 'dev en devenir']
  - ['\b', "indique la limite d'un mot", '\bdev\b', 'dev mais pas devenir']
  - ['|', "l'√©l√©ment de gauche ou celui de droite", 'devenir\|deviner', 'devenir, deviner']
  - ['{m}', "le nombre d'occurrences de l'√©l√©ment pr√©c√©dent", '1{3}', '111']
  - ['{m, n}', "l'intervalle d'occurrences recherch√©", '1{3, 4}', '111, 1111']
  - ['{n,}', "nombre minimum d'occurrences √† n", '1{2,}', '11, 111, 1111']
  - ['[abc]', "l'un des caract√®res", '[dev]', 'd, e, v']
  - ['[^abc]', "aucun de ces caract√®res", '[^dev]', 'ni d, ni e, ni v']
  - ['\', "caract√®re d'√©chappement d'un m√©ta-caract√®re", '\^', '^']
tableData2 :
  headers : ['groupe', 'caract√®res repr√©sent√©s']
  rows :
  - ['[A-Za-z]', "√† toutes les lettres de l'alphabet, majuscules et minuscules non accentu√©es"]
  - ['[0-9]', "les chiffres"]
  - ['\d', "les chiffres"]
  - ['\w', "caract√®res alphanum√©riques et l'underscore"]
  - ['\s', "un ou plusieurs espaces, tabulations ou retours √† la ligne"]
  - ['\n', "saut de ligne"]
---
import DataTable from "../../components/DataTable.astro";

Une fois n'est pas coutume, l'introduction de cet article va comporter une image, qui, √† elle seule repr√©sente le d√©samour des d√©veloppeurs pour les expressions r√©guli√®res !

![""](/devendevenir/images/regex_meme.png)

Malheureusement, le dev de droite est rest√© coinc√© avec sa regex pendant deux ans, et maintenant, il √©l√®ve des ch√®vres au fin fond du Cantal ! Pour √©viter la surpopulation d‚Äô√©leveurs de ch√®vres dans le Cantal, il faut d√©diaboliser les regex et apprendre √† mieux les conna√Ætre.

## L'origine des regex

Les regex trouvent leur origine aux √âtats-Unis, dans des √©quipes de recherche travaillant sur le syst√®me nerveux aux alentours des ann√©es 40. De ces travaux, Stephen Cole Kleene, logicien de son √©tat, a d√©crit les mod√®les neuronaux d√©couverts en termes d‚Äôensembles r√©guliers. On le consid√®re comme l‚Äôinventeur des expressions r√©guli√®res.

Mmmmmmmmh, ce n'est pas clair du tout ton affaire ! Dissipons le brouillard qui entoure les regex, au travers d'un cas d'utilisation simple.

## Regex : niveau 1

Quand vous recherchez un mot, le nom d‚Äôune variable, une phrase dans une page web, en g√©n√©ral, vous faites un Ctrl+F afin d‚Äôouvrir un champ de recherche qui recherche pour vous les occurrences d‚Äôun mot dans cette page.

Ce champ de recherche utilise une regex afin de retrouver le mot saisi !

L‚Äôexpression r√©guli√®re la plus simple est donc un mot, une phrase, une suite de caract√®res quelconques (lettres, chiffres, symboles).

```
expression r√©guli√®re : r√©gulier
mots d√©tect√©s : r√©gulier
```

Vraiment ? C‚Äôest √ßa une expression r√©guli√®re ???

OUI et NON, ce n‚Äôest pas ‚Äúque‚Äù √ßa, c‚Äôest une expression r√©guli√®re presque r√©duite √† sa plus simple expression. Si on va au bout de l'id√©e, un simple caract√®re est une expression r√©guli√®re. La force des regex, c‚Äôest qu‚Äôelles permettent de rechercher des ensembles de cha√Ænes de caract√®res plus ou moins sp√©cifiques.

Du coup, comment on peut rechercher √† la fois les termes "r√©gulier" et "r√©guli√®res" ? Il faut plonger dans la m√©canique des regex (j'aurais bien parl√© de m√©canique des expressions r√©guli√®res, mais √ßa faisait trop de "r√©guliers" dans cette phrase üòÖ).

## Regex : niveau 2

Dans un premier temps, on peut rechercher le premier mot, puis le second. Pas tr√®s pratique d√®s que le document est un peu long, et √ßa fait repasser 2 fois au m√™me endroit (pour peu qu‚Äôon ait seulement deux termes proches).

Ce qui fait la force des regex, c‚Äôest qu‚Äôelles analysent les textes par groupes de cha√Ænes de caract√®res, d'un simple caract√®re √† autant de caract√®res qu'on le souhaite.

Dans notre cas, on se rend compte que les deux mots ont des caract√©ristiques communes.

```
r√©gulier
r√©guli√®re
(r√©guli) e ou √® (r) e ou rien
```

On commence √† voir se dessiner des groupes de caract√®res communs, s√©par√©s par d'autres groupes de caract√®res qui varient dans une gamme de possibilit√©s limit√©es.

`r√©guli` n'est plus un mot, il s'agit maintenant d'un groupe de caract√®res.

### Fragmenter pour mieux rechercher

Pour rechercher les mots "r√©gulier" et "r√©guli√®re" dans un texte, on pourra utiliser l'expression r√©guli√®re suivante :

```
r√©guli
```

Vous trouverez effectivement les occurrences de "r√©gulier" et de r√©guli√®re", mais vous trouverez √©galement les occurrences de "r√©guli√®rement", "r√©guliez", et je vous passe les trois possibilit√©s restantes.

Il y a peu de chances que "r√©guli√®rement" et "r√©guliez" soient fondamentaux dans votre recherche, vous voulez donc √™tre plus sp√©cifique.

Pour cela, nous allons aborder les m√©ta-caract√®res.

### Les m√©ta-caract√®res

Vous ne le savez pas encore, mais vous avez d√©j√† vu deux de ces m√©ta-caract√®res dans cet article. Une id√©e ?

Les parenth√®ses qui d√©limitent un groupe de caract√®res sont des m√©ta-caract√®res, c'est-√†-dire des caract√®res qui donnent un sens, une fonction aux diff√©rents √©l√©ments d'une regex.

Parfois, on est amen√© √† rechercher deux mots se trouvant dans une m√™me phrase, mais n'√©tant jamais cons√©cutifs pour des raisons grammaticales. Rechercher un √©l√©ment, puis l'autre ne vous aidera pas √† trouver ce que vous cherchez. Dans ce type de cas, vous pouvez utiliser la combinaison de 2 m√©ta-caract√®res :

```
regex : Dans une regex(.*)contient
r√©sultat : Dans une regex, un groupe de caract√®res est repr√©sent√© par les caract√®res qu'il contient
```

Combin√©s, `.*` permettent donc de rechercher une cha√Æne de caract√®res de longueur quelconque, contenant des lettres, des chiffres, des signes de ponctuation, etc.

Ces m√©ta-caract√®res ne sont pas les seuls, on trouve √©galement les suivants :

<DataTable data={ frontmatter.tableData1} />

D'autres √©l√©ments permettent de caract√©riser des ensembles de caract√®res plus larges, les groupes.

### Les groupes de caract√®res

Il existe √©galement des groupes de caract√®res particuliers, permettant de traiter des groupes plus larges :

<DataTable data={ frontmatter.tableData2} />

M√™me s'il ne para√Æt pas √©vident de prime abord que tous ces √©l√©ments sont ici pour nous faciliter la vie, on peut essayer de les combiner afin d'avoir un aper√ßu de leur utilit√©.

## Boss final : construire une regex

Les cas sont infinis. Ma premi√®re confrontation avec les regex remonte √† la conversion de sp√©cifications fonctionnelles de plusieurs dizaines de pages au format docx vers un format md.

Quand vous avez des r√®gles m√©tier par dizaines, qui poss√®dent une d√©finition et de multiples ancres, les regex peut vous sauver la vie ! J'y ai √©t√© confront√©, avec des documents de plusieurs dizaines de pages, truff√©s de r√©f√©rences √† des ancres ramenant √† la d√©finition de r√®gles m√©tier.

Sur un site web, les formulaires sont de parfaits exemples. Ils doivent s'assurer que votre adresse mail a le bon format, ainsi que votre num√©ro de t√©l√©phone. Avant de devenir d√©veloppeur, jamais je ne m'√©tais pos√© la question de la technique employ√©e pour d√©tecter qu'il y a une erreur dans un formulaire, ou au contraire d√©terminer que la valeur renseign√©e est valide.

Vous vous en doutez, la r√©ponse est : les regex !

Une adresse mail a le format suivant : devendevenir@devendevenir.fr. Si on compare plusieurs adresses mail, on constate qu'elles ont toutes la m√™me structure :

```
utilisateur@domaine.extension
```

La norme RFC 3696 pr√©cise les caract√®res sp√©ciaux que peut contenir une adresse email. La norme est tr√®s permissive, et de nombreux services appliquent des restrictions suppl√©mentaires. Nous allons donc consid√©rer que l'utilisateur d'un email peut contenir un point, un underscore ou un tiret.

D√©composons chaque partie de notre adresse email sous la forme d'une expression r√©guli√®re :

```
d√©but de la cha√Æne de caract√®res : ^
utilisateur : [a-zA-Z0-9._-]
s√©paration entre utilisateur et domaine : @
domaine : [a-zA-Z0-9.-]
s√©paration entre domaine et extension : \.
extension : [a-zA-Z]{2,}
fin de la cha√Æne de caract√®res : $
```

Pris s√©par√©ment, les fragments de la regex sont compr√©hensibles, tandis que la forme compl√®te est beaucoup plus impressionnante et semble donc plus complexe.

```
^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$
```

Si on reprend chaque partie de la regex, on peut voir les contraintes suivantes :

- l'utilisateur peut avoir n'importe quel caract√®re alphanum√©rique en plus du point, de l'underscore et du tiret comme dit plus haut.
- l'arobase est obligatoire.
- le domaine peut avoir n'importe quel caract√®re alphanum√©rique en plus du point et du tiret.
- l'extension comporte uniquement des lettres, et au minimum 2. C'est cette partie qui marque la fin de la cha√Æne de caract√®res.

## Regex : cheat sheet

Je ne suis pas toujours convaincu de l'utilit√© de l'IA dans certains domaines, mais force est de constater que la g√©n√©ration d'expressions r√©guli√®res (dans des cas simples) est assez efficace.

Par ailleurs, il existe de nombreux sites web permettant de construire, tester et d√©bugger des expressions r√©guli√®res. On citera notamment [regex101](https://regex101.com/), qui est un redoutable outil pour qui est √† l'aise avec l'anglais. Ce site vous permettra de saisir une regex et de la tester. Vous pouvez √©galement coller une expression r√©guli√®re pour laquelle le site g√©n√®rera automatiquement une explication d√©taillant le r√¥le de chaque partie de votre regex.

## Conclusion

On ne croise pas tous les jours des expressions r√©guli√®res, mais depuis que je suis d√©veloppeur, je les ai d√©j√† c√¥toy√©es 2 fois en 4 ans, dans des contextes tr√®s diff√©rents (conversion de sp√©cifications fonctionnelles de docx vers md, analyse d'une image en base 64 d√©faillante dans un formulaire).

La premi√®re rencontre a √©t√© la plus difficile √† cause du volume de texte concern√©, tandis que la deuxi√®me a √©t√© beaucoup plus facile, car le travail effectu√© la premi√®re fois m'a directement servi et facilit√© la t√¢che.

Et la prochaine fois que vous recherchez 1 ou 2 termes dans un projet (variable, fonction, extrait de code), pensez-y. La plupart des IDE permettent l'utilisation de regex dans leurs outils de recherche et de remplacement.